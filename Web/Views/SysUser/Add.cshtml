@{
    Layout = "~/Views/Shared/_home.cshtml";
}
<div class="layui-card">
    <div class="layui-card-header">添加用户</div>
    <div class="layui-card-body">
        <form class="layui-form layui-form-pane" action="/sysuser/adduser" method="post">

            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li class="layui-this">账号信息</li>
                    <li>基本信息</li>
                    <li>联系信息</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show"> 
                        <div class="layui-form-item">
                            <label class="layui-form-label">登录名</label>
                            <div class="layui-input-inline">
                                <input type="text" name="UserName" maxlength="100" lay-verify="username" placeholder="" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">密码</label>
                            <div class="layui-input-inline">
                                <input type="text" name="Password" maxlength="100" lay-verify="pass" placeholder="" class="layui-input"> 
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">部门</label>
                            <div class="layui-input-inline">
                                <input type="text" name="DepartmentName" lay-verify="required" placeholder="" class="layui-input" disabled id="hdnames">
                                <input id="hddepart" type="hidden" name="DepartmentId" value="0" />
                            </div> 
                            <div class="layui-input-inline"> <a class="layui-btn layui-btn-sm"><em onclick="seltree()">选择</em></a>  </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">是否在职</label>
                            <div class="layui-input-block">
                                <input type="checkbox" checked lay-skin="switch" lay-filter="jobstate" lay-text="在职|离职">
                                <input id="hdjobstate" type="hidden" name="JobState" value="1" />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">是否启用</label>
                            <div class="layui-input-inline">
                                <input type="checkbox" checked lay-skin="switch" lay-filter="state" lay-text="启用|禁用">
                                <input id="hdstate" type="hidden" name="State" value="1" />
                            </div>
                        </div>
                    </div>
                    <div class="layui-tab-item">
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">头像</label>
                                <div class="layui-input-inline">
                                    <div style="margin:15px;margin-top:0px;">
                                        <img src="~/assets/img/avata.jpg" height="100" id="imgavata" />
                                        <input id="hdavata" type="hidden" name="Photo" />
                                        <div class="layui-input-inline">
                                            <div class="layui-btn layui-btn-primary layui-btn-sm" style="margin-left:40px;margin-top:5px;" id="imgupload" onclick="return uploads()">上传</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-input-inline">
                                    <blockquote class="layui-elem-quote" style="border-left:none;">
                                        <div>温馨提示：</div>
                                        <div>建议尺寸大小为100*100,支持png,jpg,bmp,gif格式</div>
                                      </blockquote>
                                </div>
                            </div>
                        </div> 
                        <div class="layui-form-item">
                            <label class="layui-form-label">姓名</label>
                            <div class="layui-input-inline">
                                <input type="text" name="TrueName" maxlength="100" placeholder="" class="layui-input">
                            </div> 
                            @*<label class="layui-form-label">性别</label>*@
                            <div class="layui-input-inline">
                                <input type="radio" name="Sex" value="男" title="男" checked>
                                <input type="radio" name="Sex" value="女" title="女">
                                @*<input type="radio" name="Sex" value="保密" title="保密" >*@
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">民族</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="Native" maxlength="50" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div> 
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">生日</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="Birthday" maxlength="50" placeholder="" class="layui-input" id="birthday">
                                </div>
                            </div>
                        </div> 
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">入职日期</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="JoinDate" maxlength="50" placeholder="" class="layui-input" id="joinday">
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="layui-tab-item">
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">手机号</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="MobileNumber" maxlength="100" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">电话</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="PhoneNumber" maxlength="100" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">邮箱</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="EmailAddress" maxlength="100" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div> 
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">其他联系方式</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="OtherContact" maxlength="100" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div> 
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">QQ</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="QQ" maxlength="25" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">地址</label>
                                <div class="layui-input-inline">
                                    <select id="Province" name="Province" class="select" lay-filter="org_province"></select>
                                </div><div class="layui-input-inline">
                                    <select id="City" name="City" class="select" lay-filter="org_city"></select>
                                </div><div class="layui-input-inline">
                                    <select id="Village" name="Village" lay-filter="org_area" class="select"></select>
                                </div>
                                <input id="hdProvince" type="hidden" />
                                <input id="hdCity" type="hidden" />
                                <input id="hdArea" type="hidden" />
                            </div>
                        </div> 
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">详细地址</label>
                                <div class="layui-input-block">
                                    <input type="text" name="Address" maxlength="100" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">个人简介</label>
                                <div class="layui-input-block">
                                    <textarea placeholder="请输入内容" name="Expertise" maxlength="1000" class="layui-textarea"></textarea>
                                </div>
                            </div>
                        </div>
                        @*<div class="layui-form-item">
                            <div class="layui-form-item">
                                <label class="layui-form-label">附件</label>
                                <div class="layui-input-block">
                                    <input type="text" name="Attach" placeholder="" class="layui-input">
                                </div>
                            </div>
                        </div>*@
                        <input type="hidden" name="Attach" placeholder="" class="layui-input"> 
                    </div>
                </div>
            </div> 
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit="" lay-filter="saveuser">保存</button>
                    <a class="layui-btn" id="btnGoBack">返回</a>
                </div>
            </div>

        </form>
    </div>
 </div>
    <script src="~/assets/js/PCASClass.js"></script>
    @section scripts{
        <script>
            var mypcas = new PCAS("Province,请选择省份", "City,请选择城市", "Village,请选择县区");

            layui.use(['form', 'element', 'laydate', 'upload'], function () {
                var form = layui.form, ele = layui.element, laydate = layui.laydate;

                laydate.render({
                    elem: '#birthday'
                   , type: 'datetime'
                   , format: 'yyyy.MM.dd'
                });
                laydate.render({
                    elem: '#joinday'
                   , type: 'datetime'
                   , format: 'yyyy.MM.dd'
                });
                form.verify({
                    username: function (value, item) { //value：表单的值、item：表单的DOM对象
                        if (!value) {
                            return '用户名不能为空';
                        }
                        if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)) {
                            return '用户名不能有特殊字符';
                        }
                        if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                            return '用户名首尾不能出现下划线\'_\'';
                        }
                        if (/^\d+\d+\d$/.test(value)) {
                            return '用户名不能全为数字';
                        }
                    }

                      , pass: [
                        /^[\S]{6,12}$/
                        , '密码必须6到12位，且不能出现空格'
                      ]
                });


                form.on('switch(jobstate)', function (data) {
                    $("#hdjobstate").val(this.checked ? "1" : "0");
                });
                form.on('switch(state)', function (data) {
                    $("#hdstate").val(this.checked ? "1" : "0");
                });

                layui.upload.render({ //允许上传的文件后缀
                    elem: '#imgupload'
                 , url: '/sysuser/upload/'
                 , accept: 'file'
                 , auto: true
                 , exts: 'jpg|png|gif|bmp' //只允许上传压缩文件
                 , done: function (res) {
                     if (res.flag == "ok") {
                         $("#imgavata").attr("src", res.path);
                         $("#hdavata").val(res.path);
                     }
                     return false;
                 }
                });

                //mypcas.SetValue("湖北省", "省直辖县级行政区划", "天门市");
                // form.render('select');

                var province;
                form.on('select(org_province)', function (data) {
                    province = data.value;
                    mypcas.SetValue(data.value, "", "");
                    form.render('select');
                });
                form.on('select(org_city)', function (data) {
                    mypcas.SetValue(province, data.value, "");
                    form.render('select');
                });

                form.on('submit(saveuser)', function (data) {

                    $.ajax({
                        type: "POST",
                        url: "/sysuser/adduser",
                        data: data.field,
                        async: false,
                        success: function (data) {
                            if (data.flag == 'ok') {
                                layui.layer.msg('添加成功');
                                location.href = '/sysuser/index'
                            }
                            if (data.flag == "exist") {
                                layui.layer.msg('已存在此用户名');
                            }
                            if (data.flag == "fail") {
                                layui.layer.msg('信息添加失败');
                            }
                        }
                    });
                    return false;
                });
            });

            $(function () {
                $(document).on('click', '#btnGoBack', function () {
                    location.href = '/sysuser/index';
                });
            });
             

            function setinfo(ids, names) {
                $("#hddepart").val(ids);
                $("#hdnames").val(names);
            }


            function seltree() {
                top.window.topdialog = top.layui.layer.open({
                    type: 2,
                    shade: 0.2,
                    title: '选择机构',
                    content: '/sysdep/tree?url=/sysuser/index',
                    area: ['300px', '450px'],
                });
            }

        </script>
    }
